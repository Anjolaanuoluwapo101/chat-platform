# server {
#     listen 80;
#     server_name https://talkyourtalk.onrender.com;

#     # Set the web root to your public folder
#     root /var/www/html/public;
#     index index.php index.html index.htm;

#     # Log files
#     access_log /var/log/nginx/access.log;
#     error_log /var/log/nginx/error.log;

#     # This is the "front controller" magic
#     location / {
#         try_files $uri $uri/ /index.php?$query_string;
#     }

#     # Pass PHP scripts to PHP-FPM
#     location ~ \.php$ {
#         try_files $uri =404;
#         fastcgi_split_path_info ^(.+\.php)(/.+)$;
        
#         # Connect to the PHP-FPM service (running in the same container)
#         fastcgi_pass 127.0.0.1:9000; 
        
#         fastcgi_index index.php;
#         include fastcgi_params;
#         fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
#         fastcgi_param PATH_INFO $fastcgi_path_info;
#     }

#     # Deny access to .htaccess
#     location ~ /\.ht {
#         deny all;
#     }
# }


# server {
#     listen 80;
#     server_name talkyourtalk.onrender.com;

#     root /var/www/html/public;
#     index index.php index.html;

  
#     location ^~ /api {
#         try_files $uri $uri/ /index.php?$query_string;
#     }

    
#     location / {
#         try_files $uri $uri/ /index.html;
#     }

#     location ~ \.php$ {
#         try_files $uri =404;
#         fastcgi_split_path_info ^(.+\.php)(/.+)$;
#         fastcgi_pass 127.0.0.1:9000;
#         fastcgi_index index.php;
#         include fastcgi_params;
#         fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
#         fastcgi_param PATH_INFO $fastcgi_path_info;
#     }

#     # Block .htaccess
#     location ~ /\.ht {
#         deny all;
#     }
# }

server {
    listen 80;
    server_name talkyourtalk.onrender.com;

    root /var/www/html/public;
    index index.php index.html;

    location ~* \.(assets|uploads|js|css|png|jpg|jpeg|gif|svg|ico|woff2?)$ {
        try_files $uri =404;
    }


    location ^~ /api {
        rewrite ^/api(.*)$ /index.php/api$1 last;
    }

    location / {
        try_files $uri $uri/ /index.html;
    }

    # ---------------------------
    #    PHP-FPM HANDLER (correct version)
    #    This properly handles PATH_INFO and Symfony routing
    # ---------------------------
    location ~ \.php(/|$) {
        fastcgi_split_path_info ^(.+?\.php)(/.*)$;

        # Ensure script file exists
        if (!-f $document_root$fastcgi_script_name) {
            return 404;
        }

        include fastcgi_params;

        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param PATH_INFO       $fastcgi_path_info;
        fastcgi_param PATH_TRANSLATED $document_root$fastcgi_script_name;

        fastcgi_pass 127.0.0.1:9000;
        fastcgi_index index.php;
    }

    location ~ /\.ht {
        deny all;
    }
}
